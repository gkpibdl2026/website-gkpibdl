# Changelog - 14 Januari 2026

## ðŸš€ Fitur Baru: User Management & Access Control

Hari ini telah dilakukan pembaruan besar pada sistem manajemen user dan akses kontrol role-based. Berikut adalah ringkasan perubahan:

### 1. Feature Architecture Refactoring
- **Struktur Baru**: Kode terkait users dipindahkan ke `src/features/users/`.
- **Modularisasi**: Memisahkan komponen UI (`components/UserManagementView.tsx`), API service (`services/userService.ts`), Hooks (`hooks/useUsers.ts`), dan Types (`types/index.ts`).
- **Tujuannya**: Agar kode lebih terstruktur, mudah di-maintain, dan mengikuti *Feature-Driven Architecture*.

---

### 2. User Profile Enhancements
Menambahkan field baru pada profil user untuk kebutuhan data jemaat yang lebih lengkap:
- `first_name` & `last_name`
- `whatsapp` (dengan auto-format ke +62)
- `lingkungan` (validasi integer)
- `alamat`
- `has_password` (flag untuk user yang punya password lokal)

> **âš ï¸ Required Action:** Jalankan file migrasi database berikut di Supabase SQL Editor:
> - [006_user_profile_fields.sql](../sql/migrations/006_user_profile_fields.sql)

---

### 3. User Management Page (`/admin/manage-user`)
Halaman admin ini mendapatkan upgrade signifikan:
- **Search**: Pencarian realtime berdasarkan nama (depan/belakang/google) dan email.
- **Sort**: Tabel bisa di-sort berdasarkan User, Role, Status, dan Info (Lingkungan).
- **Create User**: Tombol "Tambah User" untuk membuat akun baru secara manual (email + password).
  - Otomatis membuat user di Firebase Auth (bisa login).
  - Otomatis membuat record di Supabase.
- **Edit User**: Modal edit lengkap untuk mengubah semua data profil, role, status approval, dan **set password** user (berguna jika user awalnya login Google tapi ingin punya password lokal).
- **Inline Editing**: Role bisa diubah langsung dari dropdown di tabel.

---

### 4. Admin Access Control Improvements
- **Redirect Loop Fix**: Memperbaiki masalah *infinite redirect* pada user dengan role `jemaat` saat mengakses `/admin`.
- **Inline Access Denied**: User tanpa akses admin sekarang melihat tampilan "Akses Ditolak" langsung di layout admin, lengkap dengan tombol Logout, tanpa di-redirect paksa yang membingungkan.

### ðŸ“„ File Penting
- `src/features/users/components/UserManagementView.tsx` (Main UI)
- `src/app/api/users/route.ts` (API Create & Sync)
- `src/app/api/users/[id]/route.ts` (API Update & Delete)

### Catatan Untuk Kevin
- Setiap mulai prompting (prompt pertama), gunakan `@` lalu tagg file `AI_RULES.md`
- Tujuanya supaya AI paham struktur file nya
- Jangan pernah mengubah file `AI_RULES.md`
- Setiap selesai ngedit / kerja, sebelum istirahat, buat changelog di `/changelog`, buat file markdown baru.

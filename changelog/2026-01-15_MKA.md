# Changelog - 15 Januari 2026

## ðŸŽµ Fitur Baru: Song Module & Bible Data

Hari ini fokus pada pengembangan modul lagu (Song Module) untuk mendukung struktur lagu yang lebih kompleks (Bait, Reff, dll) dan import data Kidung Jemaat serta Alkitab Batak Toba.

### 1. Song Module Refactoring

- **Database Schema**: `songs.lyrics` di database sekarang mendukung format sections:
  ```json
  [
    { "section": "reff", "number": 1, "content": "..." },
    { "section": "bait", "number": 1, "content": "..." }
  ]
  ```
- **Admin Page (`src/app/admin/songs/page.tsx`)**:
  - Refactoring total untuk mendukung format `SongSection[]`.
  - Integrasi dengan `normalizeLyrics` helper untuk handle backward compatibility (lagu lama format verse).
  - Update form handling untuk save/update data section.
- **Component `SongVerseBuilder`**:
  - Redesign UI builder dengan dukungan drag-and-drop (reordering future plan) dan tipe section.
  - Visual distinction: Color-coding untuk Reff (Ungu), Bait (Biru), Bridge (Hijau).
- **Component `SongVersesSelector` (Warta)**:
  - Sekarang support pemilihan partial sections (misal: pilih Reff 1 & Bait 1 saja).
  - Tampilan preview lirik yang lebih rapi sesuai section.

### 2. Technical Implementation Details

- **TypeScript Types**:
  - Update interface `Song` di `lib/supabase.ts` untuk mendukung union type `lyrics: SongSection[] | SongVerse[]` (backward compatibility).
  - Update `TataIbadahItem` dengan field baru `songSections?: string[]` (array key section seperti `reff-1`, `bait-2`).
- **Helper Functions**:
  - `normalizeLyrics()`: Utility di admin page untuk konversi otomatis format lama (verse) ke format baru (section) saat loading data.
  - `getSectionKey()`: Utility untuk generate unique key untuk setiap section lagu.
- **Lint Fixes**: Memperbaiki validasi dependencies `useEffect` dan isu escaping karakter pada JSX.

---

### 2. Data Import: Kidung Jemaat (KJ)

- **Script**: Membuat `scripts/import-kj.js` yang melakukan scraping dari _alkitab.mobi_.
- **Result**: Berhasil import **478 lagu** Kidung Jemaat lengkap dengan pemisahan Bait dan Reff otomatis.
- **Database**: Data masuk ke tabel `songs` dengan kategori `KJ`.

---

### 3. Data Import: Alkitab Batak Toba

- **Support Terjemahan**: Menambahkan `TOBA` sebagai translation valid di tabel `bible_verses`.
- **Nama Kitab Batak**: Membuat migration `009_add_toba_book_names.sql` untuk menambahkan nama kitab dalam Bahasa Batak Toba (contoh: _1 Musa, Psalmen, Ulaon ni Apostel_).
- **Script**: Membuat `scripts/import-toba.js` yang mengambil data dari _Beeble API_.
- **Progress**: Berhasil import 5 kitab pertama (Kejadian - Ulangan, total 187 pasal). Import sisa 61 kitab akan dilanjutkan.
- **UI/API Integration**: Update API `route.ts` dan komponen `VerseSelector.tsx` untuk menampilkan nama kitab dalam Bahasa Batak Toba saat memilih terjemahan 'TOBA' (misal: "1 Musa" bukan "Kejadian").

---

### 4. Persiapan Data: Buku Ende (BE)

- **Research**: Mengidentifikasi _BatakPedia.org_ sebagai sumber data lirik.
- **Script**: Membuat `scripts/import-be.js` dengan _Cheerio_ untuk parsing HTML yang bervariasi.
- **Result**: Berhasil import **864 lagu** Buku Ende lengkap (BE 1 - BE 864).
- **Import Strategy**: Menggunakan multi-pass import dan perbaikan manual pada script untuk menangani variasi struktur HTML (terutama tag `<pre>` dan format nomor bait yang tidak konsisten).

---

### 6. Branding Update

- **Logo Replacement**: Mengganti logo Vercel default dengan Logo GKPI resmi (Wikimedia) pada:
  - Admin Sidebar
  - Public Navbar
  - Favicon (`layout.tsx` metadata)

---

### 5. Global Architecture Standardization (50+ Files Changed)

Agar struktur project lebih rapi dan konsisten sesuai pattern _Feature-Driven Architecture_, dilakukan standardisasi pada seluruh folder fitur:

- **Barrel Files (`index.ts`)**: Menambahkan file `index.ts` pada setiap folder fitur (Dashboard, Jadwal, Keuangan, dll) sebagai entry point standar.
- **Tujuan**: Meng-encapsulate logika internal fitur dan hanya mengekspos API public (Components, Types, Hooks) yang boleh diakses modul lain.
- **Impact**: Memudahkan import antar-modul dan menjaga clean architecture jangka panjang.

### âš ï¸ Required Action: Database Migrations

Jalankan file migrasi berikut di Supabase SQL Editor:

1. `sql/migrations/007_song_sections.sql` (Update comment & index lagu)
2. `sql/migrations/008_add_toba_translation.sql` (Enable TOBA translation)
3. `sql/migrations/009_add_toba_book_names.sql` (Add Batak Toba book names)

### ðŸ“„ File Penting

- `src/features/songs/components/SongVerseBuilder.tsx` (Builder UI)
- `src/features/warta/components/SongVersesSelector.tsx` (Selector UI)
- `scripts/import-kj.js` (KJ Import)
- `scripts/import-toba.js` (Toba Import)
- `scripts/import-be.js` (BE Import)

> **Note:** Tidak ada perubahan struktur folder utama pada modul ini. Script import baru ditempatkan di folder `scripts/` untuk pemisahan concern.
